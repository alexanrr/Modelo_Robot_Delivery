clear all; clc;

%% Cargar planificacion global
% Planificacion
load('./GlobalPlanner/TrayectoriaGlobal/Planning_2022_8_25_1_58_41'); %Si pero sin el primer y ultimo punto
%load('./GlobalPlanner/TrayectoriaGlobal/Planning_2022_8_26_23_40_29'); %si pero el punto final no va


%% Datos sobre el contacto rueda
radius = 0.082;
height = 0.045;

<<<<<<< HEAD

=======
>>>>>>> d4834f069d7b55cfb9c16b389d9825d2b28b7616
%% Cinematica
a=0.2;
b=0.15;
R=0.16/2;

m1= [1 -1 -(a+b); 1 1 (a+b); 1 1 -(a+b); 1 -1 (a+b)];
m2= (1/R)*m1;
m3= pinv(m2);


%factorE = 1.195;
factorE = 1.1;

% Inicial
pos_inicial = start;
u(1,:) = [];
x_ini= u(1,:);
y_ini= u(1,:);

<<<<<<< HEAD
x0= x_ini(1)*factorE; %pos_inicial(1) %358*factorE; %445;
y0= y_ini(2)*factorE; %pos_inicial(2) %334*factorE; %316; 
=======
x0= x_ini(1)*factorE; %445;  %pos_inicial(1) %358*factorE; 	
y0= y_ini(2)*factorE; %316;  %pos_inicial(2) %334*factorE; 
>>>>>>> d4834f069d7b55cfb9c16b389d9825d2b28b7616

% objetivo
pos_final = goal;

x_obj = pos_final(1)*factorE;
y_obj = pos_final(2)*factorE;

pos_z = ones(numel(u(:,1)),1);
zzz= pos_z*0;

x_environment = u(:,1);
y_environment = u(:,2);
z_environment = zzz;

%Puntos de trayectoria
x_m = x_environment*factorE;
y_m = y_environment*factorE;
z_m = z_environment;

<<<<<<< HEAD
M_si = [129.5231,  143.0474; 129.9081  143.0771 ; 130.2930 , 143.1069; 537,244 ; 536,245];
129.5231  143.0474
  129.9081  143.0771
  130.2930  143.1069
  130.6779  143.1366
  131.0628  143.1663
  131.4477  143.1960
=======
M_si = [0,0; 1,1; 4,2; 3,4 ; 5,5];
>>>>>>> d4834f069d7b55cfb9c16b389d9825d2b28b7616
M_ini = [x_m y_m];

pointCloud0 = [x_m y_m z_m];

div= 10;
M2= WaypointsToTrayectory(M_ini,div);

x_new = unique(M2(:,1),'stable');
y_new = unique(M2(:,2),'stable');
<<<<<<< HEAD
z_new = zeros(numel(y_new),1);
=======

numdata= numel(y_new);
tramo1 = zeros(32,1);
tramo2 = [0.15; 0.4; 0.7; 0.96; 1.1; 1.; 1.58; 1.69; 1.85; 1.98; 2.08]; %ones(11,1);
tramo3 = ones(11,1)*2.10;
tramo4 = ones(6,1)*1.5;
tramo5 = ones(5,1)*0.9;
tramo6 = ones(numdata-32-11-11-6-5,1)*0.45;
% tramo7 = ones(,1);
z_new = [tramo1; tramo2; tramo3; tramo4; tramo5; tramo6];
>>>>>>> d4834f069d7b55cfb9c16b389d9825d2b28b7616

M=  [x_new y_new];

pointCloud = [x_new y_new z_new];

%% Datos fisicos
M_chasis = 3;%3;           %kg

M_rueda =  1;           %kg
D_rueda = 1;            %

M_ruedacontacto= 1;     %kg
D_ruedacontacto= 10;    %

%% Datos de amortiguaci√≤n
K_M = 2585.125;         %N/m
c_M = 100;              %Nm/s
K_m = 3000;             %N/m


%%  Simulacion del modelo
%sim("ModeloManual");
